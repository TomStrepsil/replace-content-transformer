name: Cleanup Deleted Draft Release

on:
  release:
    types: [deleted]

permissions:
  contents: write

jobs:
  cleanup:
    name: Remove tag from deleted draft release
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Remove tag if release was deleted
        run: |
          TAG_NAME="${{ github.event.release.tag_name }}"
          
          echo "Release '${{ github.event.release.name }}' was deleted"
          echo "Checking if tag '$TAG_NAME' should be removed..."
          
          # Check if the tag exists
          if git rev-parse "$TAG_NAME" >/dev/null 2>&1; then
            echo "Tag '$TAG_NAME' exists, removing it..."
            git push origin --delete "$TAG_NAME"
            echo "âœ“ Tag '$TAG_NAME' has been removed"
          else
            echo "Tag '$TAG_NAME' does not exist (already removed or never created)"
          fi
